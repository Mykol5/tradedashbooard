jQuery(function($){function InternalTransferForm(params){WidgetForm.apply(this,arguments);var node=params.html;this.setup();this.setupDisclaimer();}
InternalTransferForm.prototype=$.extend(new WidgetForm(),{inititalSeceltor:null,setupDisclaimer:function(){var nodeDisclaimer=this.node.find('div.disclaimer');nodeDisclaimer.find('a').eq(0).click(function(){nodeDisclaimer.toggleClass('disclaimer-expanded');});},setup:function(){var form=this;var validation=this.validation=new Form(),node=this.node;this.setupFieldHighlighting(validation);this.initChain();this.inititalSeceltor=$('#accountTo').clone();this.filterAccountToField($('#accountFrom'));$('#accountFrom',form.html).change(function(){var $selector=$(this);form.filterAccountToField($selector);form.displayCurrency($selector);});$('#accountTo',form.html).change(function(){var $selector=$(this);form.displayCurrency($selector);});},filterAccountToField:function(selectorFrom){var selectedValue=selectorFrom.val();var selectedType=$('option[value="'+selectorFrom.val()+'"]',selectorFrom).attr('data-type');var selectedCode=$('option[value="'+selectorFrom.val()+'"]',selectorFrom).attr('data-type-code');var selectorToReplace=this.inititalSeceltor.clone();if(selectedType!=='placeholder'){$('option[value="'+selectedValue+'"]',selectorToReplace).remove();}
var toKeep=[];switch(selectedType)
{case'personal':$('option[value="'+selectedValue+'"]',selectorToReplace).remove();$('option[data-type="ibClient"]',selectorToReplace).remove();$('option',selectorToReplace).each(function(){const typeCode=$(this).attr('data-type-code');const isFunded=$(this).attr('data-type-is-funded');if(restrictedAccounts.includes(parseInt(typeCode))){if(!restrictedAccounts.includes(parseInt(selectedCode))){if(isFunded=='0'){$(this).remove();}}}});break;case'ibClient':toKeep.push(0);$.each(ibAccounts,function(index,value){if(selectedValue==index){toKeep.push($('option[value="'+value+'"]',selectorToReplace).index());}});$('option',selectorToReplace).each(function(index,element){if($.inArray(index,toKeep)==-1){$(this).remove();}});$('option[value="'+selectedValue+'"]',selectorToReplace).remove();$('option',selectorToReplace).each(function(){const typeCode=$(this).attr('data-type-code');const isFunded=$(this).attr('data-type-is-funded');if(restrictedAccounts.includes(parseInt(typeCode))){if(!restrictedAccounts.includes(parseInt(selectedCode))){if(isFunded=='0'){$(this).remove();}}}});break;case'ib':toKeep.push(0);$.each(ibAccounts,function(index,value){if(selectedValue==value){toKeep.push($('option[value="'+index+'"]',selectorToReplace).index());}});$('option[data-type="personal"], option[data-type="ib"]',selectorToReplace).each(function(index,element){toKeep.push($('option',selectorToReplace).index(element));});$('option',selectorToReplace).each(function(index,element){if($.inArray(index,toKeep)==-1){$(this).remove();}});$('option[value="'+selectedValue+'"]',selectorToReplace).remove();break;}
$('#accountTo').find('option').remove().end().append($('option',selectorToReplace)).val('').change();},displayCurrency:function($accountSelector){var accLogin=$accountSelector.val();if(accLogin in digitalAsset){var currList='';$.each(digitalAsset[accLogin],function(index,value){currList+='<option value="'+value+'">'+value+'</option>';});switch($accountSelector.data('direction')){case'from':$('#currencyFrom').empty().append(currList);$('#currencyFromGroup').show();break;case'to':$('#currencyTo').empty().append(currList);$('#currencyToGroup').show();break;}}else{switch($accountSelector.attr('data-direction')){case'from':$('#currencyFromGroup').hide();break;case'to':$('#currencyToGroup').hide();break;}}}});window.InternalTransferForm=new InternalTransferForm({html:$('#internalTransfersForm')});});