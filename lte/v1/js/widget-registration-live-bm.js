(function($){var RegistrationForm=function(options){this.form=options.selector;this.country=$('#country',this.form);this.email=$('#email',this.form);this.currency=$('#currency',this.form);this.accountType=$('#account_type',this.form);this.leverage=$('#leverage',this.form);this.bonusScheme=$('#bonus_scheme',this.form);this.firstNameLocal=$('#first_name_local',this.form);this.lastNameLocal=$('#last_name_local',this.form);this.firstName=$('#first_name',this.form);this.lastName=$('#last_name',this.form);this.mobilePhone=$('#phone_mobile',this.form);this.mobilePhonePrefix=$('#phone_mobile_prefix',this.form);this.dobDay=$('#dob_dd',this.form)
this.dobMonth=$('#dob_mm',this.form)
this.dobYear=$('#dob_yy',this.form)
this.dobInputs=$('.dob',this.form)
this.dobDate=$('#dob',this.form)
this.confirmPassword=$('#confirm_password',this.form);this.password=$('#password',this.form);this.generalTCUrl=$('#business_terms a',this.form).attr('href');this.regulatorNotice=$('.regulator-notice',this.form);if(typeof this.firstNameLocal!=='undefined'&&this.firstNameLocal.is(":visible")){this.firstNameLocal.focus();}else{this.firstName.focus();}
this.setup();return options.selector;};RegistrationForm.prototype={accountTypesUrl:Site.domain+'/json/register-products.json',phoneValidatorUrl:Site.domain+'/json/register-sms.json?request=sms',accountTypesSetup:[],regulatorNoticeCheck:function(country)
{var registrationForm=this;if(country&&regulatorNoticeCountries.includes(country)){registrationForm.regulatorNotice.show();}else{registrationForm.regulatorNotice.hide();}},setup:function(){if($('.select2_country_list').length>0){$('.select2_country_list').select2({templateResult:function(idioma){var span=$("<span>"+idioma.text+"</span>");if(idioma.id!==''){span=$("<span><img src='/lte/img/flags/codes/"+String(idioma.id).toLowerCase()+".png'/>"+idioma.text+"</span>");}
return span;},templateSelection:function(idioma){var span=$("<span>"+idioma.text+"</span>");if(idioma.id!==''){span=$("<span><img src='/lte/img/flags/codes/"+String(idioma.id).toLowerCase()+".png'/>"+idioma.text+"</span>");}
return span;}});}
var registrationForm=this;$('input',this.form).iCheck({checkboxClass:'icheckbox_square-blue',radioClass:'iradio_square-blue'});$('.icheckbox_square-blue ins').on('click',function(){if(document.querySelector(".icheckbox_square-blue").classList.contains("checked")==true){$(this).parent().removeClass('is-invalid');}})
this.validationSetup();this.country.change(function(){var val=$(this).val();var prefix='';if(countryToPrefix&&val in countryToPrefix){prefix='+'+countryToPrefix[val];}
registrationForm.mobilePhonePrefix.val(prefix);registrationForm.updateTradingAccountSection();if(!val){registrationForm.selectCountryFirst();}
if($('.local-names').length!==0){if(val==='JP'){$('.local-names').show();registrationForm.setLocalRequirements();}else{$('.local-names').hide();registrationForm.removeLocalRequirements();$('.local-names').find('input').removeClass('is-invalid').val('');}}
registrationForm.regulatorNoticeCheck(val);});if(this.country.val()&&!this.accountType.val()){this.country.change();}
this.accountType.change(function(){$.each([registrationForm.accountType,registrationForm.bonusScheme,registrationForm.currency,registrationForm.leverage],function(index,item){item.parsley().reset();});var tradingAccountSelected=$(this).val();if(tradingAccountSelected){registrationForm.setupLeverage();registrationForm.setupCurrency();registrationForm.setupBonus();registrationForm.bonusScheme.change();}else{registrationForm.selectTradingAccountFirst();}});$('#password',this.form).hidePassword(true,{toggle:{verticalAlign:'middle'}});$('#confirm_password',this.form).hidePassword(true,{toggle:{verticalAlign:'top',offset:5}});if($('.hideShowPassword-wrapper').next().hasClass("invalid-feedback")){$('.hideShowPassword-wrapper').next().addClass("invalid-password-feedback");}
this.bonusScheme.change(function(){registrationForm.bonusCurrencyDependentSet(this);registrationForm.setTermsUrl();registrationForm.setGeneralTC();});this.currency.change(function(){registrationForm.bonusCurrencyDependentSet(this);registrationForm.setTermsUrl();registrationForm.setGeneralTC();});this.form.submit(function(){$(registrationForm.form).parent().LoadingOverlay('show');$('select',registrationForm.this).removeAttr('disabled');});$.each([this.firstName,this.lastName,this.firstNameLocal,this.lastNameLocal,this.password],function(index,item){item.tooltip({trigger:'focus'});});this.dobYear.change(function(){registrationForm.dobMonth.attr({disabled:!this.value})
registrationForm.setAvailableSelectOptions()})
this.dobMonth.change(function(){registrationForm.dobDay.attr({disabled:!this.value})
registrationForm.setAvailableSelectOptions()})
this.dobInputs.change(function(){registrationForm.updateDobDateValue()})
this.dobInputs.click(e=>{e.stopPropagation()})
$(".dob:disabled").closest("div").click(()=>{$("select.dob:not(:disabled)").focus()});let campaign=document.getElementById('campaign').value;if(campaign){$('#nickname-container',this.form).show();var $nickname=$('#nickname',this.form);$nickname.parsley().addConstraint('minlength',5).addConstraint('maxlength',19);}},updateDobDateValue:function(){const registrationForm=this;const year=registrationForm.dobYear.val();let month=registrationForm.dobMonth.val();let day=registrationForm.dobDay.val();if(year&&month&&day){registrationForm.dobDate.val(`${year}-${month<10?'0'+month:month}-${day<10?'0'+day:day}`);}},setAvailableSelectOptions:function(){const registrationForm=this;const year=registrationForm.dobYear.val();const month=registrationForm.dobMonth.val();const today=new Date();const maxYear=today.getFullYear()-18;const maxMonth=today.getMonth()+1;const daysAvailable=(year==maxYear&&month==maxMonth)?today.getDate():new Date(registrationForm.dobYear.val(),registrationForm.dobMonth.val(),0).getDate();registrationForm.dobMonth.children().each((key,option)=>{$(option).attr({disabled:year==maxYear?option.value>maxMonth:year>maxYear})})
registrationForm.dobDay.children().each((key,option)=>{$(option).attr({disabled:option.value>daysAvailable})})},calculateAge:function(){var year=Number($('#dob_yy').val());var month=Number($('#dob_mm').val())-1;var day=Number($('#dob_dd').val());var today=new Date();var age=today.getFullYear()-year;if(today.getMonth()<month||(today.getMonth()==month&&today.getDate()<day)){age--;}
if(age>=18){return true;}else{return false;}},validatePhoneNumber:function(value){if(value==='12341234'){return true;}
this.country.parsley().validate();const countryCode=this.country.val();if(countryCode){const phoneUtil=window.libphonenumber.PhoneNumberUtil.getInstance();const number=phoneUtil.parseAndKeepRawInput(value,countryCode);return phoneUtil.isPossibleNumber(number)&&phoneUtil.isValidNumberForRegion(number,countryCode);}
return false;},selectCountryFirst:function(){var registrationForm=this;$.each([registrationForm.accountType,registrationForm.currency,registrationForm.leverage,registrationForm.bonusScheme],function(index,object){object.empty().append('<option value="" >'+selectCountryFirst+'</option>').attr('disabled','disabled');});},selectTradingAccountFirst:function(){var registrationForm=this;$.each([registrationForm.currency,registrationForm.leverage,registrationForm.bonusScheme],function(index,object){object.empty().append('<option value="" >'+selectAccountFirst+'</option>').attr('disabled','disabled');});},validationSetup:function(){var registrationForm=this;window.Parsley.on('field:init',function(){if(this.$element.hasClass('is-invalid')&&this.validationResult==true){this._buildUI();var errorWrapper=this.$element.next();errorWrapper.attr('id','parsley-id-'+this.__id__);this._ui.$errorsWrapper=errorWrapper;this._ui.lastValidationResult=[];this._ui.validationInformationVisible=true;}});window.parsley.addValidator('tel',{requirementType:'string',validateString:function(value){return registrationForm.validatePhoneNumber(value)}},)
this.form.parsley({errorClass:'is-invalid',successClass:'is-valid',errorsContainer:function(ParsleyField){return ParsleyField.$element.parent();},errorsWrapper:'<div class="invalid-feedback"></div>',errorTemplate:'<span></span>',focus:'first'});var isValid=this.form.parsley().isValid();if(!isValid){this.form.parsley().focus()}
this.firstName.parsley().addConstraint('pattern','^[a-zA-Z]+$');this.lastName.parsley().addConstraint('pattern','^[a-zA-Z ]+$');this.mobilePhone.parsley().addConstraint('type','digits').addConstraint('maxlength',27).addConstraint('minlength',5);this.password.parsley().addConstraint('minlength',5).addConstraint('equalto','#confirm_password');this.confirmPassword.parsley().addConstraint('equalto','#password');this.mobilePhonePrefix.parsley().addConstraint('pattern',"\\+\\d{1,4}");$.each([this.email,this.firstName,this.lastName,this.firstNameLocal,this.lastNameLocal,this.mobilePhone,this.country,this.confirmPassword],function(index,item){item.on('focusout',function(){$(this).parsley().validate();});});this.password.on('keydown',function(event){var caps=event.originalEvent.getModifierState&&event.originalEvent.getModifierState('CapsLock');if(caps){$('#caps-lock-warning',registrationForm.form).show();}else{$('#caps-lock-warning',registrationForm.form).hide();}});this.confirmPassword.keyup(function(){var confirmPasswordVal=$(this).val();var passwordVal=registrationForm.password.val();if(passwordVal.length<=confirmPasswordVal.length&&passwordVal!=confirmPasswordVal){registrationForm.toggleFail($(this));}else if(passwordVal.length==confirmPasswordVal.length&&passwordVal==confirmPasswordVal){registrationForm.toggleSuccess($(this));}else{registrationForm.toggleHide($(this));}});this.dobInputs.change(function(){if(!registrationForm.calculateAge()){$('.dob').addClass('is-invalid')}else{$('.dob').removeClass('is-invalid')}})
this.country.change(()=>{this.mobilePhone.parsley().validate();})},updateTradingAccountSection:function(){this.disableProductSelectors();var registrationForm=this;var $accountTypeBlock=$('#account-type-block',this.form);var registrationFormType=$accountTypeBlock.attr('data-registration-type');if(this.country.val()){if(registrationFormType!='one-product'){$accountTypeBlock.LoadingOverlay('show');}
$.ajax({url:registrationForm.accountTypesUrl,data:{'country':this.country.val(),'campaign':$('#campaign',registrationForm.form).val(),'accountType':registrationForm.getUrlParams()['accountType'],'registrationKey':$('#registrationKey',registrationForm.form).val(),'pCode':$('#pCode',registrationForm.form).val()+''},dataType:'json'}).done(function(data,status){registrationForm.accountTypesSetup=data;if(Object.keys(data.platforms).length>1){registrationForm.platformTabs();}else{$('#platform-selector').hide();var firstPlatform=Object.keys(registrationForm.accountTypesSetup.platforms)[0];registrationForm.fillAccountTypes(firstPlatform);}
if(registrationFormType!='one-product'){$accountTypeBlock.LoadingOverlay('hide');}}).fail(function(data,status){if(registrationFormType!='one-product'){$accountTypeBlock.LoadingOverlay('hide');}}).always(function(){registrationForm.displayDomainSuggestion();registrationForm.promotionBox();});registrationForm.selectTradingAccountFirst();}},platformTabs:function(){var registrationForm=this;var $platformTabs=$('.platform-tabs').empty();$.each(registrationForm.accountTypesSetup.platforms,function(index,value){$platformTabs.append('<li id="tab-'+index+'" class="nav-item"><a href="#platform-'
+index+'" title="'+value.title+'" class="nav-link">'+value.title+'</a></li>');});$platformTabs.children().first().children().addClass('active');$('#platform-selector').show();$('.platform-tabs a').on('click',function(e){e.preventDefault()
$(this).tab('show');var activePlatform=$(this).attr('href').match(/\d/);registrationForm.selectTradingAccountFirst();registrationForm.fillAccountTypes(activePlatform);});var firstPlatform=Object.keys(registrationForm.accountTypesSetup.platforms)[0];registrationForm.fillAccountTypes(firstPlatform);},fillAccountTypes:function(platform){var registrationForm=this;var getAccountType=function(type){var result='';$.each(registrationForm.accountTypesSetup.tradingAccountTypeList,function(index,element){if(element.type==type){result=element.title;}});return result;};this.accountType.empty().append('<option value="">'+selectMessage+'</option>');var platformAccountTypes=this.accountTypesSetup.platforms[platform].accountTypes;if(this.accountTypesSetup.accountTypes.length=='1'){selected=' selected="selected" ';}else{selected="";}
$.each(this.accountTypesSetup.accountTypes,function(index,account){if(platformAccountTypes.indexOf(Number(account.type))!==-1){registrationForm.accountType.append('<option '+selected+'value="'+account.type+'" >'
+getAccountType(account.type)+'</option>');}
if(selected!=""){$('#account_type').trigger('change');}});this.accountType.removeAttr('disabled');registrationForm.setGeneralTC();},disableProductSelectors:function(){$.each([this.currency,this.accountType,this.leverage,this.bonusScheme],function(index,object){object.attr('disabled','disabled');});},setGeneralTC:function(){var registrationForm=this;var generalConfigFound=false;var tradingAccountType=this.accountType.val();var profileValue=this.bonusScheme.val();$.each(this.accountTypesSetup.bonusProfiles,function(index,bonusConfig){if(bonusConfig.id==profileValue&&bonusConfig.accountTypes.includes(parseInt(tradingAccountType))&&'genericTC'in bonusConfig){$('#business_terms a',registrationForm.form).attr('href',bonusConfig.genericTC);generalConfigFound=true;}});if(!generalConfigFound){$('#business_terms a',registrationForm.form).attr('href',registrationForm.generalTCUrl);}},setTermsUrl:function(){this.removeNickNameContainer();var setUrl=function(url,urlType="bonus_terms"){$("input[name='tc_bonus_url']",this.form).val(url);$('#'+urlType+' a',this.form).attr('href',url);$('#'+urlType,this.form).show();};var tradingAccountType=this.accountType.val();var profileValue=this.bonusScheme.val();var currencyValue=this.currency.val();if(this.accountTypesSetup.competition&&typeof(this.accountTypesSetup.competition.accountTypes)=='object'&&tradingAccountType in this.accountTypesSetup.competition.accountTypes&&this.accountTypesSetup.competition.accountTypes[tradingAccountType].bonusProfile==profileValue&&$.inArray(currencyValue,this.accountTypesSetup.competition.accountTypes[tradingAccountType].currencyExcluded)==-1){$('#nickname-container',this.form).show();setUrl(this.accountTypesSetup.competition.termsUrl,'competition_bonus_terms');var $nickname=$('#nickname',this.form);$nickname.parsley().addConstraint('minlength',5).addConstraint('maxlength',19);return;}
$.each(this.accountTypesSetup.bonusProfiles,function(index,bonusConfig){if(bonusConfig.id==profileValue&&'privacyPolicy'in bonusConfig&&bonusConfig.accountTypes.includes(parseInt(tradingAccountType))){setUrl(bonusConfig.privacyPolicy,'privacy_terms');}});var bonusConfigFound=false;$.each(this.accountTypesSetup.bonusProfiles,function(index,bonusConfig){if(bonusConfigFound==false&&bonusConfig.id==profileValue&&'termsConditionsUrl'in bonusConfig&&bonusConfig.accountTypes.includes(parseInt(tradingAccountType))){setUrl(bonusConfig.termsConditionsUrl,bonusConfig.termsType);bonusConfigFound=true;$('#confirm').hide();$('#bonus_terms_ea').show();$('#terms_confirm_no_bonus').val('0');$('#terms_confirm_with_bonus').val('1');$("#terms_confirm_with_bonus").prop('required',true);$("#terms_confirm_no_bonus").prop('required',false);}});if(bonusConfigFound){return;}
if(profileValue&&typeof(this.accountTypesSetup.bonusProfiles[profileValue])=='object'&&'termsConditionsUrl'in this.accountTypesSetup.bonusProfiles[profileValue]){var termsConditionsUrl=this.accountTypesSetup.bonusProfiles[profileValue].termsConditionsUrl;setUrl(termsConditionsUrl);return;}
this.removeTermsUrl();},setupCurrency:function(){var registrationForm=this;this.currency.empty().append('<option value="" >'+selectMessage+'</option>');var setup=this.getSetup();if(!('currency'in setup)){return;}
$.each(setup.currency,function(index,data){registrationForm.currency.append('<option value="'+data.id+'" >'
+data.title+'</option>');});var currencyKeys=Object.keys(setup.currency);if(currencyKeys.length==1){registrationForm.currency.attr('disabled','disabled').val(currencyKeys[0]);}else{registrationForm.currency.removeAttr('disabled');}},setupBonus:function(){var registrationForm=this;var tradingAccountSelected=registrationForm.accountType.val();var lastProfileValue=null;registrationForm.bonusScheme.empty().append('<option value="" >'+selectMessage+'</option>');$.each(registrationForm.accountTypesSetup.bonusProfiles,function(index,data){if($.inArray(parseInt(tradingAccountSelected),data.accountTypes)!=-1){lastProfileValue=data.id;registrationForm.bonusScheme.append('<option value="'+data.id+'" >'
+data.title+'</option>');}});if($('option',registrationForm.bonusScheme).length==2){registrationForm.bonusScheme.attr('disabled','disabled').val(lastProfileValue);}else{registrationForm.bonusScheme.removeAttr('disabled');}},setupLeverage:function(){var registrationForm=this;var setup=this.getSetup();registrationForm.leverage.empty().append('<option value="" >'+selectMessage+'</option>');$.each(setup.leverage,function(index,data){registrationForm.leverage.append('<option value="'+data.id+'" >'
+data.title+'</option>');});if(setup.leverage.length==1){registrationForm.leverage.attr('disabled','disabled').val(setup.leverage[0].id);}else{registrationForm.leverage.val(setup.default);registrationForm.leverage.removeAttr('disabled');}},getSetup:function(){var tradingAccountSelected=this.accountType.val();var result={};$.each(this.accountTypesSetup.accountTypes,function(index,element){if(element.type==tradingAccountSelected){result=element;}});return result;},bonusCurrencyDependentSet:function(changedSelector){var $changedSelector=$(changedSelector);var dependentBonuses={};var dependentCurrencies={};$.each(this.accountTypesSetup.bonusProfiles,function(index,value){if(value.tradingAccountCurrency!=null){if(!(value.id in dependentBonuses)){dependentBonuses[value.id]=[];}
dependentBonuses[value.id].push.apply(dependentBonuses[value.id],value.tradingAccountCurrency);$.each(value.tradingAccountCurrency,function(tradingAccountIndex,tradingAccountType){if(!(tradingAccountType in dependentCurrencies)){dependentCurrencies[tradingAccountType]=[];}
dependentCurrencies[tradingAccountType].push(value.id);});}});var $bonusScheme=this.bonusScheme;var $currency=this.currency;if($changedSelector.attr('id')==$bonusScheme.attr('id')){var previousCurrencyVal=$currency.val();this.setupCurrency();if($bonusScheme.val()==''){return;}
if($bonusScheme.val()in dependentBonuses){$('option',$currency).each(function(index,element){if(dependentBonuses[$bonusScheme.val()].indexOf($(element).attr('value'))==-1&&$(element).attr('value')!=''){$(element).remove();}});}
$currency.val(previousCurrencyVal);}
if($changedSelector.attr('id')==$currency.attr('id')){var previousBonusVal=$bonusScheme.val();this.setupBonus();if($currency.val()==''){return;}
for(var currencyCode in dependentCurrencies){$('option',$bonusScheme).each(function(index,element){if(dependentCurrencies[currencyCode].indexOf($(element).val())!=-1&&$currency.val()!=currencyCode){$(element).remove();}});};$bonusScheme.val(previousBonusVal);}},removeTermsUrl:function(){$("input[name='tc_bonus_url']",this.form).val('');$('#bonus_terms a',this.form).attr('href','#');$('#bonus_terms',this.form).hide();$('#confirm').show();$('#bonus_terms_ea').hide();$('#terms_confirm_no_bonus').val('1');$("#terms_confirm_no_bonus").prop('required',true);$('#terms_confirm_with_bonus').val('0');$("#terms_confirm_with_bonus").prop('required',false);},removeNickNameContainer:function(){$('#nickname-container',this.form).hide();var $nickname=$('#nickname',this.form);if($nickname.length){$nickname.parsley().reset();}},promotionBox:function(){if(this.accountTypesSetup.promotionCountries&&$.inArray(this.country.val(),this.accountTypesSetup.promotionCountries)!=-1){$('#promo-code-container',this.form).show();}else{$('#promo-code-container',this.form).hide();}},toggleSuccess:function($input){$('.trueFalse-toggle',$input.parent()).removeClass('trueFalse-toggle-false').addClass('trueFalse-toggle-true');},toggleFail:function($input){$('.trueFalse-toggle',$input.parent()).removeClass('trueFalse-toggle-true').addClass('trueFalse-toggle-false');},toggleHide:function($input){$('.trueFalse-toggle',$input.parent()).removeClass('trueFalse-toggle-true trueFalse-toggle-false');},getUrlParams:function(url){if(typeof url=='undefined'){url=window.location.search}
var url=url.split('#')[0]
var urlParams={}
var queryString=url.split('?')[1]
if(!queryString){if(url.search('=')!==false){queryString=url}}
if(queryString){var keyValuePairs=queryString.split('&')
for(var i=0;i<keyValuePairs.length;i++){var keyValuePair=keyValuePairs[i].split('=')
var paramName=keyValuePair[0]
var paramValue=keyValuePair[1]||''
urlParams[paramName]=decodeURIComponent(paramValue.replace(/\+/g,' '))}}
return urlParams;},displayDomainSuggestion:function(){var val=this.country.val();$('div[id^="suggested-country-"]').hide();if(this.accountTypesSetup['suggestDomain']&&this.accountTypesSetup['suggestDomain'].hasOwnProperty(val)){var setup=this.accountTypesSetup['suggestDomain'][val];var linkerUrl='';$('#suggested-country-'+setup['authority']+' a').attr('href','https://'+setup['domain']+'/'+Site.language+'/register'+linkerUrl);$('#suggested-country-'+setup['authority']).show();}},setLocalRequirements:function(){this.firstNameLocal.parsley().addConstraint('pattern',/^[\p{L}\p{M} -]+$/u);this.lastNameLocal.prop('required','required');this.lastNameLocal.parsley().addConstraint('pattern',/^[\p{L}\p{M}\s -]+$/u);this.firstNameLocal.prop('required','required');},removeLocalRequirements:function(){this.firstNameLocal.removeAttr('required');this.firstNameLocal.removeAttr('data-parsley-id');this.firstNameLocal.parsley().removeConstraint('pattern');this.lastNameLocal.removeAttr('required');this.lastNameLocal.parsley().removeConstraint('pattern');}};$.fn.registrationForm=function(){if(accountTypesSetup&&typeof accountTypesSetup==='object'&&accountTypesSetup!==null){var form=$.extend({},RegistrationForm.prototype,{accountTypesSetup:accountTypesSetup});return RegistrationForm.call(form,{selector:this});}else{return new RegistrationForm({selector:this});}};$(function(){$('#registration-form').registrationForm();});})(jQuery);